# -*- coding: utf-8 -*-
"""WPI-(steel)_Correlation.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1-jhynZu4QxIWxlcd2P8QA-Hq1xuHWYSK
"""

import pandas as pd

# Load the Excel file (update the path if needed)
df = pd.read_excel("WPI_Master-dataset.xlsx", sheet_name="Sheet1")

# Rename columns for clarity
df = df.rename(columns={
    "WPI (stainless)": "WPI_Stainless",
    "WPI (mild flat)": "WPI_MildFlat",
    "WPI (mild long)": "WPI_MildLong",
    "WPI (Crude Petroleum)": "WPI_CrudePetroleum",
    "WPI (Iron Ore)": "WPI_IronOre",
    "WPI (Coking Coal)": "WPI_CokingCoal",
    "WPI (non-ferrous metals)": "WPI_NonFerrous",
    "(IIP 24th col)": "IIP_Metals",
    "(IIP 25th col)": "IIP_Machinery",
    "Avg. USD/INR": "USD_INR",
    "Inflation Rate (%)": "InflationRate",
    "Crude Steel Prod (MnT)": "CrudeSteel_MnT",
    "Finished Steel Prod (MnT)": "FinishedSteel_MnT",
    "Import (MnT)": "Import_MnT",
    "Export (MnT)": "Export_MnT",
    "Consumption (MnT)": "Consumption_MnT",
    "(SHFE)": "SHFE",
    "(Mild Steel Futures)": "MildSteelFutures",
    "(WPI cement)": "WPI_Cement"
})

# Check renamed columns
print(df.columns.tolist())

import matplotlib.pyplot as plt
import seaborn as sns

# Compute the correlation matrix (only for numeric columns)
corr_matrix = df.corr(numeric_only=True)

# Plot the full heatmap
plt.figure(figsize=(14, 10))
sns.heatmap(corr_matrix, annot=True, fmt=".2f", cmap="coolwarm", square=True, linewidths=0.5)
plt.title("Correlation Matrix of All Numeric Features", fontsize=16)
plt.tight_layout()
plt.show()

# Define target WPI columns
targets = ["WPI_Stainless", "WPI_MildFlat", "WPI_MildLong"]

# Loop over each target and show sorted correlations
for target in targets:
    sorted_corr = corr_matrix[target].drop(target).sort_values(key=abs, ascending=False)
    print(f"\nüîç Correlation of all features with {target} (sorted by absolute value):\n")
    print(sorted_corr.round(3))

